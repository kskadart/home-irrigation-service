
# home-irrigation-service

Лёгкий и гибкий клиент–серверный сервис для управления домашним поливом (умный полив грядок / газона) на базе Raspberry Pi.

## Архитектура

- **Backend**: Python 3.12 + FastAPI  
  - чтение датчиков (влажность/температура воздуха, влажность/температура почвы);
  - управление электромагнитным клапаном через MOSFET;
  - автоматический контроллер полива (по порогам, окну времени, дневному лимиту);
  - HTTP API для управления и мониторинга.
- **Frontend**: Next.js (React)  
  - веб‑клиент по Wi‑Fi: дашборд показаний, ручное управление, настройки (планируется).

## Комплектация (основное железо)

**Вычислительная часть**
- Raspberry Pi 4B (4 ГБ ОЗУ).
- microSD 32–64 ГБ (класс A1/A2).

**Питание**
- Блок питания 12 В, 60 Вт, IP67.
- DC–DC преобразователь 12 → 5 В (USB‑C, ≥3 А) для Raspberry Pi.
- Сетевой шнур с вилкой Schuko (3×0.75–1.0 мм²).
- Предохранители:
  - 3 А (линия 12 В → 5 В для Raspberry Pi);
  - 1 А (линия клапана).

**Гидравлика и силовая часть**
- Электромагнитный клапан воды 12 В DC, нормально закрытый (NC), латунь, 1/2".
- MOSFET‑модуль 5–36 В, 15 А (low‑side ключ, вход 3.3 В).
- Диод Шоттки 1N5819 (шунт катушки клапана).
- Электролитический конденсатор 470–1000 µF, ≥25 В (на линии 12 В у клапана).

**Датчики**
- SHT31‑D — датчик температуры и влажности воздуха (I²C, 3.3 В).
- DS18B20 — герметичный датчик температуры почвы (1‑Wire).
- Датчик влажности/температуры почвы с аналоговым выходом 0–10 В, IP68.
- ADS1115 — 16‑битный АЦП (I²C, 3.3 В) для чтения 0–10 В датчика через делитель.

## Быстрый старт (backend)

```bash
python -m venv .venv
source .venv/bin/activate      # Windows: .venv\Scripts\activate
pip install -r requirements.txt

uvicorn app.main:app --host 0.0.0.0 --port 8000
```

Эндпоинты:
- `GET /status/metrics` — текущие показания датчиков и состояние контроллера.
- `POST /control/mode` — переключение режима `auto` / `manual`.
- `POST /control/valve` — ручное открытие/закрытие клапана (с опцией `seconds`).

## Клиент

### CLI (Python)

```bash
python -m client.cli status
python -m client.cli mode auto
python -m client.cli valve open --seconds 30
```

### Web‑клиент (Next.js)

Отдельное приложение на Next.js, которое:
- ходит к API `home-irrigation-service` по HTTP;
- рисует графики влажности/температур;
- позволяет управлять режимами и циклами полива.

(Структура и код фронтенда планируются отдельно, под этот же API.)
